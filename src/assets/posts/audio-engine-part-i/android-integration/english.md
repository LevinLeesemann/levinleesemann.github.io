Android wasn't completely new territory either. I had already built a functional, though never shipped, Android implementation for my metronome app. So I knew roughly what I was signing up for. In practice, that meant starting in Kotlin, going through JNI, and then ending up in C++, since that's where Oboe lives. There's a fair amount of glue code involved in that journey, and while none of it is especially exciting, it's hard to avoid.

As with the other platforms, I started by creating a test harness app alongside a library that contained the actual audio driver implementation. The pattern setup for each platform was quite clear at this point: A library with a producer and consumer thread, some native audio API setup, implementing the KMM interface defined functions, and a test harness app to run the whole thing.

As you can imagine, the Android implementation ended up looking quite similar to iOS. The main difference was the threading model. Instead of using platform-managed queues, the producer ran on a dedicated C++ thread. The consumer side was handled by Oboe's callback mechanism, which also felt familiar by this point.

As this came together, it became increasingly obvious that I was reimplementing a lot of the same logic I had already written for the web and iOS. Context switching between all three platforms also started to get tricky, since each one had slightly different constraints and expectations, which made it easy to forget which logic was housed where in a given native layer.

While writing all of this glue code, another issue became harder to ignore. The Rust engine still relied on global statics, and resource cleanup wasn't really considered as part of the design yet. That might be acceptable for a quick prototype, but for mobile platforms in particular it's a real problem, especially since handling re-initialization after sleeping, interruptions from other applications that need audio, etc. are part of the equation. This issue, alongside the overlap in logic previously mentioned drove the next round of development.